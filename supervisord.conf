; =============================================================================
; SUPERVISORD CONFIGURATION
; =============================================================================
; Process manager for continuous data collection
;
; Usage:
;   supervisord -c supervisord.conf           # Start all workers
;   supervisorctl -c supervisord.conf status  # Check status
;   supervisorctl -c supervisord.conf stop all
;   supervisorctl -c supervisord.conf start all
;   supervisorctl -c supervisord.conf restart all
;   supervisorctl -c supervisord.conf tail -f polymarket-worker
;   supervisorctl -c supervisord.conf shutdown  # Stop supervisord
;
; Before starting, ensure VENV environment variable is set:
;   export VENV=$(pwd)/.venv
; =============================================================================

[supervisord]
nodaemon=false
logfile=logs/supervisord.log
pidfile=supervisord.pid
childlogdir=logs

[unix_http_server]
file=supervisor.sock

[supervisorctl]
serverurl=unix://supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

; =============================================================================
; WORKER PROGRAMS
; =============================================================================

[program:polymarket-worker]
command=%(ENV_VENV)s/bin/python services/ingest_polymarket.py --daemon
directory=%(here)s
environment=PYTHONUNBUFFERED="1"
autostart=true
autorestart=true
startsecs=5
startretries=3
stderr_logfile=logs/polymarket-worker.err.log
stdout_logfile=logs/polymarket-worker.out.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5

[program:kalshi-worker]
command=%(ENV_VENV)s/bin/python services/ingest_kalshi.py --daemon
directory=%(here)s
environment=PYTHONUNBUFFERED="1"
autostart=true
autorestart=true
startsecs=5
startretries=3
stderr_logfile=logs/kalshi-worker.err.log
stdout_logfile=logs/kalshi-worker.out.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5

[program:stx-worker]
command=%(ENV_VENV)s/bin/python services/ingest_stx.py --daemon
directory=%(here)s
environment=PYTHONUNBUFFERED="1"
autostart=true
autorestart=true
startsecs=5
startretries=3
stderr_logfile=logs/stx-worker.err.log
stdout_logfile=logs/stx-worker.out.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5

[program:detector]
command=%(ENV_VENV)s/bin/python services/detect_opportunities.py --daemon --interval 30
directory=%(here)s
environment=PYTHONUNBUFFERED="1"
autostart=true
autorestart=true
startsecs=5
startretries=3
stderr_logfile=logs/detector.err.log
stdout_logfile=logs/detector.out.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5

; =============================================================================
; PROGRAM GROUPS
; =============================================================================

[group:workers]
programs=polymarket-worker,kalshi-worker,stx-worker,detector
priority=999
